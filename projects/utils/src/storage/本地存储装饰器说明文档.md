# 本地存储说明文档

## 概述

本项目中提供了两种存储机制：`SessionStorage` 和 `LocalStorage`，分别用于会话存储和本地存储。这些存储机制通过装饰器的形式集成到 Angular 组件中，方便开发者在应用中管理和持久化数据。

## 接口定义

### 基本存储配置接口 `IStorageConfig<T>`

```typescript
interface IStorageConfig<T> {
    defaultValue: T; // 存储的默认值
    propertyKey?: string; // 属性键（可选）
    version?: string; // 版本（可选，默认为 1.0.0）
}
```

### 会话存储配置接口 `ISessionConfig<T>`

```typescript
export interface ISessionConfig<T = unknown> extends IStorageConfig<T> {}
```

### 本地存储配置接口 `ILocalConfig<T>`

```typescript
export interface ILocalConfig<T = unknown> extends IStorageConfig<T> {
    expirationTime?: number; // 过期时间（毫秒）（可选）
}
```

## 装饰器

### 会话存储装饰器 `SessionStorage`

```typescript
function SessionStorage(config: ISessionConfig);
```

- **参数**:
    - `config`: 会话存储配置
- **用法**:
    ```typescript
    @SessionStorage({ defaultValue: 0, version: '1.0.2' })
    count1!: BehaviorSubject<number>;
    ```

### 本地存储装饰器 `LocalStorage`

```typescript
function LocalStorage(config: ILocalConfig);
```

- **参数**:
    - `config`: 本地存储配置
- **用法**:
    ```typescript
    @LocalStorage({ defaultValue: 0, expirationTime: 1000 * 10, propertyKey: 'num' })
    count2!: BehaviorSubject<number>;
    ```

## 示例

### 在组件中使用存储

#### app.component.html

```html
<button (click)="count1.next(count1.value + 1)">{{ count1.value }}+</button>
<button (click)="count2.next(count2.value + 1)">{{ count2.value }}+</button>
```

#### app.component.ts

```typescript
import { Component, OnInit } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { LocalStorage, SessionStorage } from './storage';

@Component({
    selector: 'app-root',
    templateUrl: './app.component.html',
    styleUrls: ['./app.component.scss'],
})
export class AppComponent implements OnInit {
    title = 'hello';

    @SessionStorage({ defaultValue: 0, version: '1.0.2' })
    count1!: BehaviorSubject<number>;

    @LocalStorage({ defaultValue: 0, expirationTime: 1000 * 10, propertyKey: 'num' })
    count2!: BehaviorSubject<number>;

    ngOnInit(): void {
        console.log(this.count.value); // 输出会话存储的当前值
    }
}
```

## 注意事项

1. **版本管理**: 如果存储的数据版本不匹配，会自动删除旧数据并使用默认值。
2. **过期时间**: 本地存储支持设置过期时间，过期后数据将被自动删除；如果发送 `null` 则会返回默认值。
3. **错误处理**: 存储和读取过程中可能会发生错误，这些错误会被捕获并记录到控制台。

希望这份文档能帮助你更好地理解和使用项目中的存储功能。如有任何疑问，请随时联系开发团队。
